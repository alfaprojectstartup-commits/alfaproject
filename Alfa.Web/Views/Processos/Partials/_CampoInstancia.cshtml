@model Alfa.Web.Dtos.CampoInstanciaViewModel
@using System.Collections.Generic
@using System.Globalization
@using System.Linq

@{
    var tipo = (Model?.Tipo ?? string.Empty).ToLowerInvariant();
    var numberValue = Model?.ValorNumero?.ToString(CultureInfo.InvariantCulture) ?? string.Empty;
    var dateValue = Model?.ValorData?.ToString("yyyy-MM-dd", CultureInfo.InvariantCulture) ?? string.Empty;
    var valorTexto = Model?.ValorTexto ?? string.Empty;
    var opcoes = (Model?.Opcoes ?? new List<Alfa.Web.Dtos.CampoOpcaoViewModel>())
        .Where(o => o.Ativo)
        .OrderBy(o => o.Ordem)
        .ToList();
}

<div class="mb-3" data-campo-id="@Model?.Id" data-tipo="@tipo">
    @if (tipo == "checkbox")
    {
        <div class="form-check">
            <input class="form-check-input" type="checkbox" data-field-input id="campo_@Model?.Id" @(Model?.ValorBool == true ? "checked" : string.Empty) />
            <label class="form-check-label" for="campo_@Model?.Id">
                @Model?.Rotulo
                @if (Model?.Obrigatorio == true)
                {
                    <span class="badge bg-light text-danger border border-danger ms-2">Obrigatório</span>
                }
            </label>
            @if (!string.IsNullOrWhiteSpace(Model?.Ajuda))
            {
                <div class="form-text">@Model?.Ajuda</div>
            }
        </div>
    }
    else
    {
        <label class="form-label" for="campo_@Model?.Id">
            @Model?.Rotulo
            @if (Model?.Obrigatorio == true)
            {
                <span class="badge bg-light text-danger border border-danger ms-2">Obrigatório</span>
            }
        </label>

        @switch (tipo)
        {
            case "number":
                <input class="form-control" type="number" data-field-input id="campo_@Model?.Id" value="@numberValue" placeholder="@Model?.Placeholder" />;
                break;
            case "date":
                <input class="form-control" type="date" data-field-input id="campo_@Model?.Id" value="@dateValue" placeholder="@Model?.Placeholder" />;
                break;
            case "textarea":
                <textarea class="form-control" data-field-input id="campo_@Model?.Id" placeholder="@Model?.Placeholder" rows="4">@valorTexto</textarea>;
                break;
            case "select":
                {
                    var valorAtual = valorTexto;
                    <select class="form-select" data-field-input id="campo_@Model?.Id">
                        @if (Model?.Obrigatorio != true)
                        {
                            <option value="">@(string.IsNullOrWhiteSpace(Model?.Placeholder) ? "Selecione" : Model.Placeholder)</option>
                        }
                        @foreach (var opcao in opcoes)
                        {
                            var valorOpcao = opcao.Valor ?? opcao.Texto;
                            <option value="@valorOpcao" @(valorAtual == valorOpcao ? "selected" : string.Empty)>@opcao.Texto</option>
                        }
                    </select>;
                }
                break;
            default:
                <input class="form-control" type="text" data-field-input id="campo_@Model?.Id" value="@valorTexto" placeholder="@Model?.Placeholder" />;
                break;
        }

        @if (!string.IsNullOrWhiteSpace(Model?.Ajuda))
        {
            <div class="form-text">@Model?.Ajuda</div>
        }
    }
</div>
